<html>
<head>

<!--vendors -->
<script type="text/javascript" src="js/vnd/jquery-1.8.2.min.js">
</script>

<!--engine -->

<script type="text/javascript" src="js/engine/common.js">
</script>

<script type="text/javascript" src="js/engine/sprite.js">
</script>

<script type="text/javascript" src="js/engine/ai.js">
</script>

<script type="text/javascript">


function waitUntilTrue(delegate,execute){
	console.log("waitUntilTrue enter");
	
	console.log("delegate = "+delegate);
	console.log("execute = "+execute);
	
	
	if(delegate()){
		console.log("waitUntilTrue/ before execute");
		execute();
	}
	else 
	{
		console.log("waitUntilTrue/ scheduling timeout for 500ms");
		setTimeout(function (){
			waitUntilTrue(delegate,execute);
		},500);
	}
}
function loadComponents(list,i){
	
	$(".screen").text("loading "+i / list.length );
	
	console.log("loadComponents/ enter");
	console.log("loadComponents/ enter i = " + i);
	console.log("loadComponents/ enter list = " + list);
		
	if(typeof i == 'undefined'){
		console.log("initializing index  i");
		i = 0;
	}
	
	console.log("i = " + i);
		
	var componentId = list[i].name;
	var initCode = list[i].action;
	
	console.log("componentId = " + componentId);
	console.log("initCode = " + initCode );
	
	var initComponent = function () { eval (initCode); };
	
	var checkComponentloaded = function () { return eval ("typeof " + componentId + " != 'undefined'"); }
	var loadComponentAndoveNext = function (){
			console.log("loadComponentAndoveNext enter");
			console.log("i = "+ i );
	
			initComponent();
			if ( i  < list.length) {
				loadComponents(list , i + 1);
			}
		}		
	
	console.log("before waitUntilTrue");
	
	waitUntilTrue( checkComponentloaded, loadComponentAndoveNext);
	//load components sequencialy (?) 
}

//bootstrapping 
$(function () {
	
			
	
	loadComponents( [{ name : 'init' ,action : 'init()' }] ); 
	
	/*
	waitUntilLoaded(function () { return typeof init != 'undefined'} , 
		function(){
				log("initializing");
				init();
							
				log("loading sprites");
				loadSprites(spriteSheetData);
				
				log("loading map");
				loadMap(mapData);
				
				log("loading entities");
				loadEntities(getEntities());
				
				log("starting scene");
				startScene();
		}
	);
	*/
	
	
});
</script>


<style type="text/css">
.screen
{
	width:512px;
	height:512px;
	border: 1px solid black
}
</style>
</head>
<body>

<div class="screen" id="screen">
</div>

</body>
</html>